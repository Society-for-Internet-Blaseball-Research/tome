(this.webpackJsonptome=this.webpackJsonptome||[]).push([[0],{27:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n,s=a(0),c=a.n(s),r=a(20),o=a.n(r),i=(a(27),a(4)),u=a(2),l=a(22),d=a(11),h=a.n(d),m=a(18),j=a(15),b="https://api.sibr.dev/corsmechanics/blaseball/";function f(e,t){return p.apply(this,arguments)}function p(){return(p=Object(j.a)(h.a.mark((function e(t,a){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===a?"":"?".concat(new URLSearchParams(a).toString()),e.abrupt("return",fetch("".concat(t).concat(n)).then((function(e){return e.json()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){void 0!==n&&n.close(),(n=new EventSource("".concat(b,"/events/streamData"))).addEventListener("open",(function(){console.log("listening for game updates (id=".concat(e,")"))})),n.addEventListener("message",(function(a){var s,c,r,o=null===(s=JSON.parse(a.data).value)||void 0===s||null===(c=s.games)||void 0===c||null===(r=c.schedule)||void 0===r?void 0:r.find((function(t){return t.id===e}));o&&(t(o),o.gameComplete&&void 0!==n&&n.close())})),n.addEventListener("error",(function(){console.log("restarting stream ".concat(e)),void 0!==n&&n.close(),setTimeout((function(){return v(e,t)}),2e3)}))}function O(e){return g.apply(this,arguments)}function g(){return(g=Object(j.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f("".concat(b,"/database/team?id=").concat(t)).then((function(e){for(var t=new Map,a=0;a<e.lineup.length;a++)t.set(e.lineup[a],a);return t})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){var t=Object(s.useState)(),a=Object(i.a)(t,2),n=a[0],c=a[1],r=Object(s.useState)(),o=Object(i.a)(r,2),u=o[0],l=o[1],d=Object(s.useState)(),h=Object(i.a)(d,2),j=h[0],p=h[1];Object(s.useEffect)((function(){f("".concat(b,"/database/gameById/").concat(e)).then((function(t){l(t),t&&!t.gameComplete&&v(e,l),Promise.all([O(t.awayTeam),O(t.homeTeam)]).then((function(e){p(new Map([].concat(Object(m.a)(e[0]),Object(m.a)(e[1]))))}))})).catch((function(e){return c(e)}))}),[e]);var g=[null===u||void 0===u?void 0:u.baseRunners,null===u||void 0===u?void 0:u.awayBatter,null===u||void 0===u?void 0:u.homeBatter],x=Object(s.useState)([]),w=Object(i.a)(x,2),S=w[0],y=w[1];Object(s.useEffect)((function(){void 0!==(null===u||void 0===u?void 0:u.statsheet)&&f("".concat(b,"/database/gameStatsheets"),{ids:u.statsheet}).then((function(e){return y(e)})).catch((function(e){return c(e)}))}),[null===u||void 0===u?void 0:u.statsheet].concat(g));var k=Object(s.useState)([]),B=Object(i.a)(k,2),I=B[0],N=B[1];Object(s.useEffect)((function(){var e=S.flatMap((function(e){return[e.awayTeamStats,e.homeTeamStats]}));e.length>0&&f("".concat(b,"/database/teamStatsheets"),{ids:e.join(",")}).then((function(e){return N(e)})).catch((function(e){return c(e)}))}),[S]);var R=Object(s.useState)([]),E=Object(i.a)(R,2),T=E[0],C=E[1];return Object(s.useEffect)((function(){var e=I.flatMap((function(e){return e.playerStats}));e.length>0&&f("".concat(b,"/database/playerStatsheets"),{ids:e.join(",")}).then((function(e){var t=e.reduce((function(e,t){return(e[t.playerId]=e[t.playerId]||[]).push(t),e}),{}),a=[];for(var n in t)a.push(t[n].reduce((function(e,t){return{id:t.id,playerId:t.playerId,name:t.name,team:t.team,teamId:t.teamId,atBats:t.atBats+(e.atBats||0),caughtStealing:t.caughtStealing+(e.caughtStealing||0),doubles:t.doubles+(e.doubles||0),earnedRuns:t.earnedRuns+(e.earnedRuns||0),groundIntoDp:t.groundIntoDp+(e.groundIntoDp||0),hitBatters:t.hitBatters+(e.hitBatters||0),hitByPitch:t.hitByPitch+(e.hitByPitch||0),hits:t.hits+(e.hits||0),hitsAllowed:t.hitsAllowed+(e.hitsAllowed||0),homeRuns:t.homeRuns+(e.homeRuns||0),losses:t.losses+(e.losses||0),outsRecorded:t.outsRecorded+(e.outsRecorded||0),pitchesThrown:t.pitchesThrown+(e.pitchesThrown||0),quadruples:t.quadruples+(e.quadruples||0),rbis:t.rbis+(e.rbis||0),runs:t.runs+(e.runs||0),stolenBases:t.stolenBases+(e.stolenBases||0),strikeouts:t.strikeouts+(e.strikeouts||0),struckouts:t.struckouts+(e.struckouts||0),triples:t.triples+(e.triples||0),walks:t.walks+(e.walks||0),walksIssued:t.walksIssued+(e.walksIssued||0),wins:t.wins+(e.wins||0)}}),{}));void 0!==j&&(a=a.sort((function(e,t){var a,n;return(null!==(a=j.get(e.playerId))&&void 0!==a?a:0)>(null!==(n=j.get(t.playerId))&&void 0!==n?n:0)?1:-1}))),C(a)})).catch((function(e){return c(e)}))}),[I,j]),{error:n,game:u,stats:{game:S,team:I,player:T}}}var w=a(1);function S(e){return Object(w.jsx)("div",{className:"container mx-auto my-4 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-100 px-4 py-3 rounded",role:"alert",children:e.children})}var y=window.matchMedia("(prefers-color-scheme: dark)");function k(){var e=window.localStorage.getItem("color-scheme");return"light"===e||"dark"===e?e:y.matches?"dark":"light"}function B(){"dark"===k()?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function I(e){var t=Number(e);return Number.isNaN(t)?e:String.fromCodePoint(t)}var N=function(e){var t=e.stats,a=e.cols,n=e.team,s=e.batter;return Object(w.jsxs)("div",{className:"statCard",children:[n&&Object(w.jsx)("div",{children:n}),Object(w.jsxs)("table",{children:[Object(w.jsxs)("tr",{children:[Object(w.jsx)("td",{}),a.map((function(e){return Object(w.jsx)("th",{children:e[1]})}))]}),t.player.map((function(e){return e[a[0][0]]>0&&(!n||e.team===n)&&Object(w.jsxs)("tr",{id:e.playerId,className:"statRow",children:[Object(w.jsxs)("th",{className:"playerName",children:[s===e.name?I("127951"):""," ",e.name]}),a.map((function(t){return Object(w.jsx)("td",{className:"statCell",children:e[t[0]]})}))]})}))]})]})},R=function(e){var t=e.gameId;if(!t||"0"===t)return Object(w.jsx)("div",{children:"Select a game."});var a=x(t),n=a.error,s=a.game,c=a.stats;if(n)return Object(w.jsx)(S,{children:n.toString()});if(void 0===s)return Object(w.jsx)("div",{children:"loading statsheets..."});if(0===c.player.length)return s.gameComplete?Object(w.jsx)("div",{children:"loading statsheets..."}):Object(w.jsx)("div",{children:"waiting for game to start..."});var r=[["atBats","AB"],["runs","R"],["hits","H"],["doubles","2B"],["triples","3B"],["quadruples","4B"],["homeRuns","HR"],["stolenBases","SB"],["struckouts","K"],["walks","BB"],["rbis","RBI"]];return Object(w.jsxs)("div",{children:[Object(w.jsx)(N,{stats:c,cols:r,team:s.awayTeamName,batter:s.awayBatterName}),Object(w.jsx)(N,{stats:c,cols:r,team:s.homeTeamName,batter:s.homeBatterName}),Object(w.jsx)(N,{stats:c,cols:[["pitchesThrown","P"],["hitsAllowed","H"],["strikeouts","K"],["walksIssued","BB"],["earnedRuns","R"]]})]})},E=function(e){for(var t=e.curSeason,a=e.onChange,n=e.name,s=e.value,c=[],r=t;r>=0;r--)c.push(Object(w.jsx)("option",{value:r,children:r+1},r));return Object(w.jsxs)("select",{name:n,onChange:a,className:"gameSelectorInput",value:s||-1,children:[Object(w.jsx)("option",{value:"-1",selected:!0,disabled:!0,hidden:!0,children:-1===t?"loading":n}),c]})},T=function(){var e=Object(s.useState)("light"===k()?"\ud83c\udf1a":"\ud83c\udf1e"),t=Object(i.a)(e,2),a=t[0],n=t[1];return Object(w.jsx)("input",{type:"button",onClick:function(e){!function(){var e="light"===k()?"dark":"light";window.localStorage.setItem("color-scheme",e),B()}(),n("light"===k()?"\ud83c\udf1a":"\ud83c\udf1e")},value:a,className:"displayModeButton"})},C=function(e){var t=Object(u.f)(),a=Object(s.useState)(),n=Object(i.a)(a,2),c=n[0],r=n[1],o=Object(s.useState)(),l=Object(i.a)(o,2),d=l[0],h=l[1],m=Object(s.useState)(),j=Object(i.a)(m,2),p=j[0],v=j[1],O=Object(s.useState)(-1),g=Object(i.a)(O,2),x=g[0],S=g[1],y=Object(s.useState)(-1),k=Object(i.a)(y,2),B=k[0],N=k[1],C=Object(s.useState)(),L=Object(i.a)(C,2),D=L[0],M=L[1];return Object(s.useEffect)((function(){c&&d&&(M([]),f("".concat(b,"/database/games?season=").concat(d,"&day=").concat(c)).then((function(e){M(e)})))}),[c,d]),Object(s.useEffect)((function(){f("".concat(b,"/database/simulationData")).then((function(e){S(e.season),N(e.day)})).then((function(){var t;return(null===(t=e.match)||void 0===t?void 0:t.params.gameid)?f("".concat(b,"/database/gameById/").concat(e.match.params.gameid)):null})).then((function(e){e&&(r(e.day),h(e.season),v(e.id))}))}),[]),Object(w.jsxs)("div",{className:"gameSelector",children:[Object(w.jsx)("label",{htmlFor:"Season",className:"gameSelectorLabel",children:"Season"}),Object(w.jsx)(E,{curSeason:x,onChange:function(e){h(e.target.value),v("0"),N(-1),f("".concat(b,"/database/seasondaycount?season=").concat(e.target.value)).then((function(e){N(e.dayCount+1)}))},name:"Season",value:d}),Object(w.jsx)("label",{htmlFor:"Day",className:"gameSelectorLabel",children:"Day"}),Object(w.jsx)(E,{curSeason:B,onChange:function(e){r(e.target.value),v("0")},name:"Day",value:c}),Object(w.jsxs)("select",{name:"game",id:"game",onChange:function(e){v(e.target.value),t.push("/".concat(e.target.value))},value:p,children:[Object(w.jsx)("option",{value:"0",selected:!0,disabled:!0,hidden:!0,children:D?"Select a game":"Enter a day"}),D&&D.map((function(e){return Object(w.jsxs)("option",{value:e.id,children:[I(e.awayTeamEmoji)," ",e.awayTeamNickname," at"," ",I(e.homeTeamEmoji)," ",e.homeTeamNickname]})}))]}),Object(w.jsx)(R,{gameId:p}),Object(w.jsx)(T,{}),Object(w.jsxs)("div",{className:"footer",children:["Icons from ",Object(w.jsx)("a",{href:"https://game-icons.net/",children:"game-icons.net"})]})]})};var L=function(){return Object(w.jsx)(l.a,{children:Object(w.jsx)("div",{className:"container mx-auto px-4",children:Object(w.jsxs)(u.c,{children:[Object(w.jsx)(u.a,{path:"/:gameid",component:C}),Object(w.jsx)(u.a,{path:"/",children:Object(w.jsx)(C,{})})]})})})};B(),y.addListener(B),o.a.render(Object(w.jsx)(c.a.StrictMode,{children:Object(w.jsx)(L,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.b2a6b33f.chunk.js.map